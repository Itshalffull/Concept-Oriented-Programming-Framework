@version(1)
concept Group [G] {
  purpose {
    Create isolated content spaces with group-level role-based access control
    for multi-tenant collaboration.
  }

  state {
    groups: set G;
    memberships: G -> set String;
    groupRoles: G -> String;
    groupContent: G -> set String;
    name: G -> String
  }

  actions {
    action createGroup(group: G, name: String) {
      -> ok() { Isolated content space created with the given name. }
      -> exists(message: String) { Group already exists. }
    }

    action addMember(group: G, user: String, role: String) {
      -> ok() { User added to the group's membership with the specified role. }
      -> notfound(message: String) { Group does not exist. }
    }

    action assignGroupRole(group: G, user: String, role: String) {
      -> ok() { The member's role within the group updated to the new value. }
      -> notfound(message: String) { Group or member does not exist. }
    }

    action addContent(group: G, content: String) {
      -> ok() { Content entity placed under the group's access scope. }
      -> notfound(message: String) { Group does not exist. }
    }

    action checkGroupAccess(group: G, user: String, permission: String) {
      -> ok(granted: Bool) { Returns whether the user has the permission in this group. }
      -> notfound(message: String) { Group does not exist. }
    }
  }

  invariant {
    after createGroup(group: g, name: n) -> ok()
    then addMember(group: g, user: u, role: "member") -> ok()
    and  checkGroupAccess(group: g, user: u, permission: "read") -> ok(granted: true)
  }
}
