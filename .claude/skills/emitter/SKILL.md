---
name: emitter
description: Materialize generated content as files Content addressed : 
 same input produces same hash , skip write preserves timestamps 
 Handles formatting , directory structure , orphan cleanup , 
 source traceability , and drift detection
argument-hint: $ARGUMENTS
allowed-tools: Read, Grep, Glob, Bash
---

<!-- Auto-generated by COPF Interface Kit — claude-skills target -->
<!-- Concept: Emitter -->
<!-- Do not edit manually; regenerate with: copf interface generate -->

# Emitter

Manage generated file output for **$ARGUMENTS** with content-addressed writes, source traceability, and drift detection.


> **When to use:** Use when writing generated files, auditing for drift, tracing source provenance, or cleaning orphaned outputs.


## Design Principles

- **Content-Addressed Writes:** Files are only written when their content hash changes — identical rewrites are skipped.
- **Source Provenance:** Every output file tracks which source files and concept actions produced it.

## Step-by-Step Process

### Step 1: Write Single File

Write a single generated file with content-addressed deduplication.

**Arguments:** `$0` **path** (string), `$1` **content** (string), `$2` **formatHint** (string?), `$3` **sources** (unknown[]?)

**Checklist:**
- [ ] Path is within the designated output directory?
- [ ] Content hash computed before write?

**Examples:**
*Write a single file*
```typescript
const result = await emitterHandler.write(
  { path: 'generated/user.types.ts', content: typesCode, formatHint: 'typescript' },
  storage,
);
```

### Step 2: Emit Generated Files

Atomically write a batch of generated files with content-addressed deduplication.

**Arguments:** `$0` **files** (unknown[])

**Checklist:**
- [ ] All source provenance metadata attached?
- [ ] Format hint set for each file?
- [ ] Output directory exists?

**Examples:**
*Batch write generated files*
```typescript
const result = await emitterHandler.writeBatch(
  { files: [{ path: 'user.types.ts', content: types }, { path: 'user.handler.ts', content: handler }] },
  storage,
);
```

### Step 3: Drift Detection

Compare generated files on disk against expected output to detect manual edits.

**Arguments:** `$0` **outputDir** (string)

**Checklist:**
- [ ] Generated files match expected hashes?
- [ ] No manual edits detected?

**Examples:**
*Audit generated directory*
```bash
copf emitter audit ./generated
```

### Step 4: Orphan Cleanup

Remove output files that are no longer produced by any generator.

**Arguments:** `$0` **outputDir** (string), `$1` **currentManifest** (string[])

**Checklist:**
- [ ] Current manifest accurately lists all expected files?
- [ ] Orphaned files identified and removed?

**Examples:**
*Remove orphaned files*
```bash
copf emitter clean ./generated
```

### Step 5: Source Provenance

Show which source files and concept actions produced a given output file.

**Arguments:** `$0` **outputPath** (string)

**Checklist:**
- [ ] Output path resolves to a tracked generated file?
- [ ] Source provenance entries are complete?

**Examples:**
*Trace source provenance*
```bash
copf emitter trace ./generated/user.types.ts
```

### Step 6: Impact Analysis

Show what output files are affected by a change to a given source file.

**Arguments:** `$0` **sourcePath** (string)

**Checklist:**
- [ ] Source path resolves to a tracked input?
- [ ] All downstream outputs identified?

**Examples:**
*Show impact of changing a source file*
```bash
copf emitter affected ./specs/app/user.concept
```

## References

- [Emitter architecture and traceability](references/emitter-architecture.md)
## Quick Reference

| Action | Command | Purpose |
|--------|---------|---------|
| write | `copf emitter write` | Write a single file |
| writeBatch | `copf emitter write-batch` | Atomic batch write |
| audit | `copf emitter audit <dir>` | Detect drift |
| clean | `copf emitter clean <dir>` | Remove orphans |
| trace | `copf emitter trace <path>` | Show source provenance |
| affected | `copf emitter affected <path>` | Show impact of a source change |
| manifest | `copf emitter manifest <dir>` | List all tracked outputs |
| format | `copf emitter format <path>` | Format a generated file |


## Validation

*Audit generated files:*
```bash
npx tsx cli/src/index.ts generate --audit
```
*Clean orphans:*
```bash
npx tsx cli/src/index.ts generate --clean
```
## Related Skills

| Skill | When to Use |
| --- | --- |
| `/cache-build` | Build cache uses Emitter for output |
| `/implementation-builder` | Code generation writes through Emitter |
