// Auto-generated by Clef Clef Bind â€” cli target
// Concept: TestSelection
// Do not edit manually; regenerate with: clef interface generate

import { Command } from 'commander';

export const testSelectionCommand = new Command('test-selection')
  .description('Select the minimum set of tests to run given a code change 
 Maintain source to test mappings from runtime coverage data 
 Prioritize tests by historical failure probability , change 
 proximity , and execution cost Enable confident defect 
 detection while minimizing total test execution time');

testSelectionCommand
  .command('analyze')
  .description('Given changed source files , compute which tests are 
 affected using stored source to test coverage mappings 
 If testType is provided , only return tests of that type 
 Otherwise returns all affected tests across all types 
 Relevance score ( 0 -1 ) based on : 
 Direct coverage ( test exercises changed code ) : 1.0 
 Transitive dependency : 0.5 -0.9 
 Historical co failure : variable 
 Reason explains why each test was selected : 
 direct-coverage , transitive-dep , co-failure-history')
  .requiredOption('--changed-sources <changedSources>', 'Changed Sources')
  .requiredOption('--test-type <testType>', 'Test Type')
  .option('--json', 'Output as JSON')
  .action(async (opts) => {
    const result = await globalThis.kernel.handleRequest({ method: 'analyze', ...opts });
    console.log(opts.json ? JSON.stringify(result) : result);
  });

testSelectionCommand
  .command('select')
  .description('From the affected tests , select the subset to run 
 within the given budget Prioritized by : 
 1 Recent failure history ( tests that failed recently ) 
 2 Relevance score ( higher more likely affected ) 
 3 Execution cost ( faster tests first for quick signal ) 
 If no budget specified , returns all affected tests')
  .requiredOption('--affected-tests <affectedTests>', 'Affected Tests')
  .requiredOption('--budget <budget>', 'Budget')
  .option('--json', 'Output as JSON')
  .action(async (opts) => {
    const result = await globalThis.kernel.handleRequest({ method: 'select', ...opts });
    console.log(opts.json ? JSON.stringify(result) : result);
  });

testSelectionCommand
  .command('record')
  .description('Update source to test coverage mapping after a test 
 execution testType indicates which runner produced the 
 coverage data ( e g , unit , e2e , integration ) 
 This is how mappings are built instrumenting test runs 
 to collect file level coverage , then storing the 
 test to source mapping')
  .requiredOption('--test-id <testId>', 'Test Id')
  .requiredOption('--language <language>', 'Language')
  .requiredOption('--test-type <testType>', 'Test Type')
  .requiredOption('--covered-sources <coveredSources>', 'Covered Sources')
  .requiredOption('--duration <duration>', 'Duration')
  .requiredOption('--passed <passed>', 'Passed')
  .option('--json', 'Output as JSON')
  .action(async (opts) => {
    const result = await globalThis.kernel.handleRequest({ method: 'record', ...opts });
    console.log(opts.json ? JSON.stringify(result) : result);
  });

testSelectionCommand
  .command('statistics')
  .description('Return selection effectiveness statistics 
 Selection ratio : what fraction of tests are typically 
 selected ( lower more efficient )')
  .option('--json', 'Output as JSON')
  .action(async (opts) => {
    const result = await globalThis.kernel.handleRequest({ method: 'statistics', ...opts });
    console.log(opts.json ? JSON.stringify(result) : result);
  });

export const testSelectionCommandTree = {
  group: 'test-selection',
  description: 'Select the minimum set of tests to run given a code change 
 Maintain source to test mappings from runtime coverage data 
 Prioritize tests by historical failure probability , change 
 proximity , and execution cost Enable confident defect 
 detection while minimizing total test execution time',
  commands: [{ action: 'analyze', command: 'analyze' }, { action: 'select', command: 'select' }, { action: 'record', command: 'record' }, { action: 'statistics', command: 'statistics' }],
};
