// Auto-generated by COPF Interface Kit â€” cli target
// Concept: Migration
// Do not edit manually; regenerate with: copf interface generate

import { Command } from 'commander';

export const migrationCommand = new Command('migration')
  .description('Track concept schema versions and gate concept startup 
 Detect when a concept s deployed storage schema differs from 
 its current spec version and coordinate migration steps');

migrationCommand
  .command('check')
  .description('The concept s storage version matches the spec version 
 Concept is clear to serve requests')
  .requiredOption('--concept <concept>', 'Concept')
  .requiredOption('--spec-version <specVersion>', 'Spec Version')
  .option('--json', 'Output as JSON')
  .action(async (opts) => {
    const result = await globalThis.kernel.handleRequest({ method: 'check', ...opts });
    console.log(opts.json ? JSON.stringify(result) : result);
  });

migrationCommand
  .command('complete')
  .description('Record that the concept has been migrated to the given version 
 Remove from pending set Concept can now serve requests')
  .requiredOption('--concept <concept>', 'Concept')
  .requiredOption('--version <version>', 'Version')
  .option('--json', 'Output as JSON')
  .action(async (opts) => {
    const result = await globalThis.kernel.handleRequest({ method: 'complete', ...opts });
    console.log(opts.json ? JSON.stringify(result) : result);
  });

export const migrationCommandTree = {
  group: 'migration',
  description: 'Track concept schema versions and gate concept startup 
 Detect when a concept s deployed storage schema differs from 
 its current spec version and coordinate migration steps',
  commands: [{ action: 'check', command: 'check' }, { action: 'complete', command: 'complete' }],
};
