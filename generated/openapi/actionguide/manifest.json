{
  "uri": "urn:clef/ActionGuide",
  "name": "ActionGuide",
  "typeParams": [
    {
      "name": "W",
      "wireType": "string"
    }
  ],
  "relations": [
    {
      "name": "entries",
      "source": "merged",
      "keyField": {
        "name": "w",
        "paramRef": "W"
      },
      "fields": [
        {
          "name": "concept",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          },
          "optional": false
        },
        {
          "name": "steps",
          "type": {
            "kind": "list",
            "inner": {
              "kind": "record",
              "fields": [
                {
                  "name": "action",
                  "type": {
                    "kind": "primitive",
                    "primitive": "String"
                  },
                  "optional": false
                },
                {
                  "name": "title",
                  "type": {
                    "kind": "primitive",
                    "primitive": "String"
                  },
                  "optional": false
                },
                {
                  "name": "prose",
                  "type": {
                    "kind": "primitive",
                    "primitive": "String"
                  },
                  "optional": false
                },
                {
                  "name": "order",
                  "type": {
                    "kind": "primitive",
                    "primitive": "Int"
                  },
                  "optional": false
                }
              ]
            }
          },
          "optional": false
        },
        {
          "name": "content",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          },
          "optional": false
        }
      ]
    },
    {
      "name": "workflows",
      "source": "set-valued",
      "keyField": {
        "name": "w",
        "paramRef": "W"
      },
      "fields": [
        {
          "name": "value",
          "type": {
            "kind": "param",
            "paramRef": "W"
          },
          "optional": false
        }
      ]
    }
  ],
  "actions": [
    {
      "name": "define",
      "params": [
        {
          "name": "concept",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          }
        },
        {
          "name": "steps",
          "type": {
            "kind": "list",
            "inner": {
              "kind": "primitive",
              "primitive": "String"
            }
          }
        },
        {
          "name": "content",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          }
        }
      ],
      "variants": [
        {
          "tag": "ok",
          "fields": [
            {
              "name": "workflow",
              "type": {
                "kind": "param",
                "paramRef": "W"
              }
            },
            {
              "name": "stepCount",
              "type": {
                "kind": "primitive",
                "primitive": "Int"
              }
            }
          ],
          "prose": "Action guide created with ordered steps Content JSON \n attached as opaque decoration"
        },
        {
          "tag": "invalidAction",
          "fields": [
            {
              "name": "action",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            }
          ],
          "prose": "A step references an action not found in the concept"
        },
        {
          "tag": "emptySteps",
          "fields": [],
          "prose": "No steps were provided"
        }
      ],
      "description": "Create an action guide from a concept s actions Steps are \n ordered action names with titles and prose the concept \n owns this structure The content string is JSON from the \n interface manifest containing decorations whose internal \n structure is not constrained by this concept Targets \n interpret keys they recognize ( e g checklists , \n references , examples , anti patterns , design principles , \n content sections , validation commands , quick reference , \n related workflows ) and pass through the rest"
    },
    {
      "name": "render",
      "params": [
        {
          "name": "workflow",
          "type": {
            "kind": "param",
            "paramRef": "W"
          }
        },
        {
          "name": "format",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          }
        }
      ],
      "variants": [
        {
          "tag": "ok",
          "fields": [
            {
              "name": "content",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            }
          ],
          "prose": "Rendered action guide content in the requested format"
        },
        {
          "tag": "unknownFormat",
          "fields": [
            {
              "name": "format",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            }
          ],
          "prose": "The requested format is not recognized"
        }
      ],
      "description": "Render an action guide in the requested format Supported formats \n include skill md , cli help , rest guide , and generic Each \n format produces output suited to its target audience \n The renderer deserializes the content JSON and picks out \n keys it understands for the given format"
    }
  ],
  "invariants": [
    {
      "description": "invariant 1: after define, render behaves correctly",
      "setup": [
        {
          "action": "define",
          "inputs": [
            {
              "name": "concept",
              "value": {
                "kind": "literal",
                "value": "SpecParser"
              }
            },
            {
              "name": "steps",
              "value": {
                "kind": "list",
                "items": [
                  {
                    "kind": "literal",
                    "value": "parse"
                  }
                ]
              }
            },
            {
              "name": "content",
              "value": {
                "kind": "literal",
                "value": "{\"design-principles\":[{\"title\":\"Independence\",\"rule\":\"Parse without external state\"}]}"
              }
            }
          ],
          "expectedVariant": "ok",
          "expectedOutputs": [
            {
              "name": "workflow",
              "value": {
                "kind": "variable",
                "name": "w"
              }
            },
            {
              "name": "stepCount",
              "value": {
                "kind": "literal",
                "value": 1
              }
            }
          ]
        }
      ],
      "assertions": [
        {
          "action": "render",
          "inputs": [
            {
              "name": "workflow",
              "value": {
                "kind": "variable",
                "name": "w"
              }
            },
            {
              "name": "format",
              "value": {
                "kind": "literal",
                "value": "skill-md"
              }
            }
          ],
          "expectedVariant": "ok",
          "expectedOutputs": [
            {
              "name": "content",
              "value": {
                "kind": "variable",
                "name": "c"
              }
            }
          ]
        }
      ],
      "freeVariables": [
        {
          "name": "w",
          "testValue": "u-test-invariant-001"
        },
        {
          "name": "c",
          "testValue": "u-test-invariant-002"
        }
      ]
    }
  ],
  "graphqlSchema": "type ActionGuideState {\n  \"\"\"All ws in this concept\"\"\"\n  ws: [ID!]!\n}\n\ntype ActionGuideEntry {\n  w: ID!\n  concept: String!\n  steps: [JSON!]!\n  content: String!\n}\n\nextend type Query {\n  actionguide_entry(w: ID!): ActionGuideEntry\n  actionguide_entries: [ActionGuideEntry!]!\n}\n\ntype ActionGuideWorkflows {\n  w: ID!\n  value: ID!\n}",
  "jsonSchemas": {
    "invocations": {
      "define": {
        "$id": "urn:clef/ActionGuide/define/invocation",
        "type": "object",
        "properties": {
          "concept": {
            "const": "urn:clef/ActionGuide"
          },
          "action": {
            "const": "define"
          },
          "input": {
            "type": "object",
            "properties": {
              "concept": {
                "type": "string"
              },
              "steps": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "content": {
                "type": "string"
              }
            },
            "required": [
              "concept",
              "steps",
              "content"
            ]
          }
        }
      },
      "render": {
        "$id": "urn:clef/ActionGuide/render/invocation",
        "type": "object",
        "properties": {
          "concept": {
            "const": "urn:clef/ActionGuide"
          },
          "action": {
            "const": "render"
          },
          "input": {
            "type": "object",
            "properties": {
              "workflow": {
                "type": "string"
              },
              "format": {
                "type": "string"
              }
            },
            "required": [
              "workflow",
              "format"
            ]
          }
        }
      }
    },
    "completions": {
      "define": {
        "ok": {
          "$id": "urn:clef/ActionGuide/define/completion/ok",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:clef/ActionGuide"
            },
            "action": {
              "const": "define"
            },
            "variant": {
              "const": "ok"
            },
            "output": {
              "type": "object",
              "properties": {
                "workflow": {
                  "type": "string"
                },
                "stepCount": {
                  "type": "integer"
                }
              },
              "required": [
                "workflow",
                "stepCount"
              ]
            }
          }
        },
        "invalidAction": {
          "$id": "urn:clef/ActionGuide/define/completion/invalidAction",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:clef/ActionGuide"
            },
            "action": {
              "const": "define"
            },
            "variant": {
              "const": "invalidAction"
            },
            "output": {
              "type": "object",
              "properties": {
                "action": {
                  "type": "string"
                }
              },
              "required": [
                "action"
              ]
            }
          }
        },
        "emptySteps": {
          "$id": "urn:clef/ActionGuide/define/completion/emptySteps",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:clef/ActionGuide"
            },
            "action": {
              "const": "define"
            },
            "variant": {
              "const": "emptySteps"
            },
            "output": {
              "type": "object",
              "properties": {},
              "required": []
            }
          }
        }
      },
      "render": {
        "ok": {
          "$id": "urn:clef/ActionGuide/render/completion/ok",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:clef/ActionGuide"
            },
            "action": {
              "const": "render"
            },
            "variant": {
              "const": "ok"
            },
            "output": {
              "type": "object",
              "properties": {
                "content": {
                  "type": "string"
                }
              },
              "required": [
                "content"
              ]
            }
          }
        },
        "unknownFormat": {
          "$id": "urn:clef/ActionGuide/render/completion/unknownFormat",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:clef/ActionGuide"
            },
            "action": {
              "const": "render"
            },
            "variant": {
              "const": "unknownFormat"
            },
            "output": {
              "type": "object",
              "properties": {
                "format": {
                  "type": "string"
                }
              },
              "required": [
                "format"
              ]
            }
          }
        }
      }
    }
  },
  "capabilities": [],
  "purpose": "Organize concept actions into ordered , annotated workflow \n sequences for interface targets The concept owns step \n ordering ( structural ) and opaque content passthrough for \n decorations Each target reads the content keys it \n understands ( checklists , design principles , anti patterns , \n validation commands , etc ) and ignores the rest New \n decoration kinds require only a new YAML key and a \n renderer in the target provider zero concept changes \n Renamed from Workflow to avoid collision with \n kits automation workflow concept ( FSM with guarded transitions ) \n See Architecture doc Section 1.8"
}
