{
  "uri": "urn:copf/VercelRuntime",
  "name": "VercelRuntime",
  "typeParams": [
    {
      "name": "V",
      "wireType": "string"
    }
  ],
  "relations": [
    {
      "name": "entries",
      "source": "merged",
      "keyField": {
        "name": "v",
        "paramRef": "V"
      },
      "fields": [
        {
          "name": "projectId",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          },
          "optional": false
        },
        {
          "name": "teamId",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          },
          "optional": false
        },
        {
          "name": "framework",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          },
          "optional": false
        },
        {
          "name": "regions",
          "type": {
            "kind": "list",
            "inner": {
              "kind": "primitive",
              "primitive": "String"
            }
          },
          "optional": false
        },
        {
          "name": "deploymentUrl",
          "type": {
            "kind": "option",
            "inner": {
              "kind": "primitive",
              "primitive": "String"
            }
          },
          "optional": false
        },
        {
          "name": "currentDeploymentId",
          "type": {
            "kind": "option",
            "inner": {
              "kind": "primitive",
              "primitive": "String"
            }
          },
          "optional": false
        },
        {
          "name": "previousDeploymentId",
          "type": {
            "kind": "option",
            "inner": {
              "kind": "primitive",
              "primitive": "String"
            }
          },
          "optional": false
        },
        {
          "name": "productionUrl",
          "type": {
            "kind": "option",
            "inner": {
              "kind": "primitive",
              "primitive": "String"
            }
          },
          "optional": false
        }
      ]
    },
    {
      "name": "projects",
      "source": "set-valued",
      "keyField": {
        "name": "v",
        "paramRef": "V"
      },
      "fields": [
        {
          "name": "value",
          "type": {
            "kind": "param",
            "paramRef": "V"
          },
          "optional": false
        }
      ]
    }
  ],
  "actions": [
    {
      "name": "provision",
      "params": [
        {
          "name": "concept",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          }
        },
        {
          "name": "teamId",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          }
        },
        {
          "name": "framework",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          }
        }
      ],
      "variants": [
        {
          "tag": "ok",
          "fields": [
            {
              "name": "project",
              "type": {
                "kind": "param",
                "paramRef": "V"
              }
            },
            {
              "name": "projectId",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            },
            {
              "name": "endpoint",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            }
          ],
          "prose": "Vercel project created with specified framework"
        },
        {
          "tag": "domainConflict",
          "fields": [
            {
              "name": "domain",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            },
            {
              "name": "existingProject",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            }
          ],
          "prose": "Domain already assigned to another project"
        }
      ]
    },
    {
      "name": "deploy",
      "params": [
        {
          "name": "project",
          "type": {
            "kind": "param",
            "paramRef": "V"
          }
        },
        {
          "name": "sourceDirectory",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          }
        }
      ],
      "variants": [
        {
          "tag": "ok",
          "fields": [
            {
              "name": "project",
              "type": {
                "kind": "param",
                "paramRef": "V"
              }
            },
            {
              "name": "deploymentId",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            },
            {
              "name": "deploymentUrl",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            }
          ],
          "prose": "Build completed and deployment created"
        },
        {
          "tag": "buildFailed",
          "fields": [
            {
              "name": "project",
              "type": {
                "kind": "param",
                "paramRef": "V"
              }
            },
            {
              "name": "errors",
              "type": {
                "kind": "list",
                "inner": {
                  "kind": "primitive",
                  "primitive": "String"
                }
              }
            }
          ],
          "prose": "Vercel build step failed"
        }
      ]
    },
    {
      "name": "setTrafficWeight",
      "params": [
        {
          "name": "project",
          "type": {
            "kind": "param",
            "paramRef": "V"
          }
        },
        {
          "name": "weight",
          "type": {
            "kind": "primitive",
            "primitive": "Int"
          }
        }
      ],
      "variants": [
        {
          "tag": "ok",
          "fields": [
            {
              "name": "project",
              "type": {
                "kind": "param",
                "paramRef": "V"
              }
            }
          ],
          "prose": "Traffic split between current and previous deployments"
        }
      ]
    },
    {
      "name": "rollback",
      "params": [
        {
          "name": "project",
          "type": {
            "kind": "param",
            "paramRef": "V"
          }
        },
        {
          "name": "targetDeploymentId",
          "type": {
            "kind": "primitive",
            "primitive": "String"
          }
        }
      ],
      "variants": [
        {
          "tag": "ok",
          "fields": [
            {
              "name": "project",
              "type": {
                "kind": "param",
                "paramRef": "V"
              }
            },
            {
              "name": "restoredDeploymentId",
              "type": {
                "kind": "primitive",
                "primitive": "String"
              }
            }
          ],
          "prose": "Production alias pointed to previous deployment"
        }
      ]
    },
    {
      "name": "destroy",
      "params": [
        {
          "name": "project",
          "type": {
            "kind": "param",
            "paramRef": "V"
          }
        }
      ],
      "variants": [
        {
          "tag": "ok",
          "fields": [
            {
              "name": "project",
              "type": {
                "kind": "param",
                "paramRef": "V"
              }
            }
          ],
          "prose": "Project and all deployments deleted"
        }
      ]
    }
  ],
  "invariants": [
    {
      "description": "invariant 1: after provision, deploy behaves correctly",
      "setup": [
        {
          "action": "provision",
          "inputs": [
            {
              "name": "concept",
              "value": {
                "kind": "literal",
                "value": "User"
              }
            },
            {
              "name": "teamId",
              "value": {
                "kind": "literal",
                "value": "team-1"
              }
            },
            {
              "name": "framework",
              "value": {
                "kind": "literal",
                "value": "nextjs"
              }
            }
          ],
          "expectedVariant": "ok",
          "expectedOutputs": [
            {
              "name": "project",
              "value": {
                "kind": "variable",
                "name": "p"
              }
            },
            {
              "name": "projectId",
              "value": {
                "kind": "variable",
                "name": "pid"
              }
            },
            {
              "name": "endpoint",
              "value": {
                "kind": "variable",
                "name": "ep"
              }
            }
          ]
        }
      ],
      "assertions": [
        {
          "action": "deploy",
          "inputs": [
            {
              "name": "project",
              "value": {
                "kind": "variable",
                "name": "p"
              }
            },
            {
              "name": "sourceDirectory",
              "value": {
                "kind": "literal",
                "value": "./dist"
              }
            }
          ],
          "expectedVariant": "ok",
          "expectedOutputs": [
            {
              "name": "project",
              "value": {
                "kind": "variable",
                "name": "p"
              }
            },
            {
              "name": "deploymentId",
              "value": {
                "kind": "variable",
                "name": "did"
              }
            },
            {
              "name": "deploymentUrl",
              "value": {
                "kind": "variable",
                "name": "url"
              }
            }
          ]
        }
      ],
      "freeVariables": [
        {
          "name": "p",
          "testValue": "u-test-invariant-001"
        },
        {
          "name": "pid",
          "testValue": "u-test-invariant-002"
        },
        {
          "name": "ep",
          "testValue": "u-test-invariant-003"
        },
        {
          "name": "did",
          "testValue": "u-test-invariant-004"
        },
        {
          "name": "url",
          "testValue": "u-test-invariant-005"
        }
      ]
    }
  ],
  "graphqlSchema": "type VercelRuntimeState {\n  \"\"\"All vs in this concept\"\"\"\n  vs: [ID!]!\n}\n\ntype VercelRuntimeEntry {\n  v: ID!\n  projectId: String!\n  teamId: String!\n  framework: String!\n  regions: [String!]!\n  deploymentUrl: String!\n  currentDeploymentId: String!\n  previousDeploymentId: String!\n  productionUrl: String!\n}\n\nextend type Query {\n  vercelruntime_entry(v: ID!): VercelRuntimeEntry\n  vercelruntime_entries: [VercelRuntimeEntry!]!\n}\n\ntype VercelRuntimeProjects {\n  v: ID!\n  value: ID!\n}",
  "jsonSchemas": {
    "invocations": {
      "provision": {
        "$id": "urn:copf/VercelRuntime/provision/invocation",
        "type": "object",
        "properties": {
          "concept": {
            "const": "urn:copf/VercelRuntime"
          },
          "action": {
            "const": "provision"
          },
          "input": {
            "type": "object",
            "properties": {
              "concept": {
                "type": "string"
              },
              "teamId": {
                "type": "string"
              },
              "framework": {
                "type": "string"
              }
            },
            "required": [
              "concept",
              "teamId",
              "framework"
            ]
          }
        }
      },
      "deploy": {
        "$id": "urn:copf/VercelRuntime/deploy/invocation",
        "type": "object",
        "properties": {
          "concept": {
            "const": "urn:copf/VercelRuntime"
          },
          "action": {
            "const": "deploy"
          },
          "input": {
            "type": "object",
            "properties": {
              "project": {
                "type": "string"
              },
              "sourceDirectory": {
                "type": "string"
              }
            },
            "required": [
              "project",
              "sourceDirectory"
            ]
          }
        }
      },
      "setTrafficWeight": {
        "$id": "urn:copf/VercelRuntime/setTrafficWeight/invocation",
        "type": "object",
        "properties": {
          "concept": {
            "const": "urn:copf/VercelRuntime"
          },
          "action": {
            "const": "setTrafficWeight"
          },
          "input": {
            "type": "object",
            "properties": {
              "project": {
                "type": "string"
              },
              "weight": {
                "type": "integer"
              }
            },
            "required": [
              "project",
              "weight"
            ]
          }
        }
      },
      "rollback": {
        "$id": "urn:copf/VercelRuntime/rollback/invocation",
        "type": "object",
        "properties": {
          "concept": {
            "const": "urn:copf/VercelRuntime"
          },
          "action": {
            "const": "rollback"
          },
          "input": {
            "type": "object",
            "properties": {
              "project": {
                "type": "string"
              },
              "targetDeploymentId": {
                "type": "string"
              }
            },
            "required": [
              "project",
              "targetDeploymentId"
            ]
          }
        }
      },
      "destroy": {
        "$id": "urn:copf/VercelRuntime/destroy/invocation",
        "type": "object",
        "properties": {
          "concept": {
            "const": "urn:copf/VercelRuntime"
          },
          "action": {
            "const": "destroy"
          },
          "input": {
            "type": "object",
            "properties": {
              "project": {
                "type": "string"
              }
            },
            "required": [
              "project"
            ]
          }
        }
      }
    },
    "completions": {
      "provision": {
        "ok": {
          "$id": "urn:copf/VercelRuntime/provision/completion/ok",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:copf/VercelRuntime"
            },
            "action": {
              "const": "provision"
            },
            "variant": {
              "const": "ok"
            },
            "output": {
              "type": "object",
              "properties": {
                "project": {
                  "type": "string"
                },
                "projectId": {
                  "type": "string"
                },
                "endpoint": {
                  "type": "string"
                }
              },
              "required": [
                "project",
                "projectId",
                "endpoint"
              ]
            }
          }
        },
        "domainConflict": {
          "$id": "urn:copf/VercelRuntime/provision/completion/domainConflict",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:copf/VercelRuntime"
            },
            "action": {
              "const": "provision"
            },
            "variant": {
              "const": "domainConflict"
            },
            "output": {
              "type": "object",
              "properties": {
                "domain": {
                  "type": "string"
                },
                "existingProject": {
                  "type": "string"
                }
              },
              "required": [
                "domain",
                "existingProject"
              ]
            }
          }
        }
      },
      "deploy": {
        "ok": {
          "$id": "urn:copf/VercelRuntime/deploy/completion/ok",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:copf/VercelRuntime"
            },
            "action": {
              "const": "deploy"
            },
            "variant": {
              "const": "ok"
            },
            "output": {
              "type": "object",
              "properties": {
                "project": {
                  "type": "string"
                },
                "deploymentId": {
                  "type": "string"
                },
                "deploymentUrl": {
                  "type": "string"
                }
              },
              "required": [
                "project",
                "deploymentId",
                "deploymentUrl"
              ]
            }
          }
        },
        "buildFailed": {
          "$id": "urn:copf/VercelRuntime/deploy/completion/buildFailed",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:copf/VercelRuntime"
            },
            "action": {
              "const": "deploy"
            },
            "variant": {
              "const": "buildFailed"
            },
            "output": {
              "type": "object",
              "properties": {
                "project": {
                  "type": "string"
                },
                "errors": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "required": [
                "project",
                "errors"
              ]
            }
          }
        }
      },
      "setTrafficWeight": {
        "ok": {
          "$id": "urn:copf/VercelRuntime/setTrafficWeight/completion/ok",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:copf/VercelRuntime"
            },
            "action": {
              "const": "setTrafficWeight"
            },
            "variant": {
              "const": "ok"
            },
            "output": {
              "type": "object",
              "properties": {
                "project": {
                  "type": "string"
                }
              },
              "required": [
                "project"
              ]
            }
          }
        }
      },
      "rollback": {
        "ok": {
          "$id": "urn:copf/VercelRuntime/rollback/completion/ok",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:copf/VercelRuntime"
            },
            "action": {
              "const": "rollback"
            },
            "variant": {
              "const": "ok"
            },
            "output": {
              "type": "object",
              "properties": {
                "project": {
                  "type": "string"
                },
                "restoredDeploymentId": {
                  "type": "string"
                }
              },
              "required": [
                "project",
                "restoredDeploymentId"
              ]
            }
          }
        }
      },
      "destroy": {
        "ok": {
          "$id": "urn:copf/VercelRuntime/destroy/completion/ok",
          "type": "object",
          "properties": {
            "concept": {
              "const": "urn:copf/VercelRuntime"
            },
            "action": {
              "const": "destroy"
            },
            "variant": {
              "const": "ok"
            },
            "output": {
              "type": "object",
              "properties": {
                "project": {
                  "type": "string"
                }
              },
              "required": [
                "project"
              ]
            }
          }
        }
      }
    }
  },
  "capabilities": [],
  "purpose": "Manage Vercel project deployments Owns project \n configurations , deployment URLs , edge regions , \n and serverless function settings"
}
