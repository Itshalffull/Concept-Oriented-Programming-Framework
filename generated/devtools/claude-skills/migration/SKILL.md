---
name: migration
description: Track concept schema versions and gate concept startup 
 Detect when a concept s deployed storage schema differs from 
 its current spec version and coordinate migration steps
argument-hint: $ARGUMENTS
allowed-tools: Read, Grep, Glob, Edit, Write, Bash
---

<!-- Auto-generated by COPF Interface Kit — claude-skills target -->
<!-- Concept: Migration -->
<!-- Do not edit manually; regenerate with: copf interface generate -->

# Migration

Plan and apply schema migration for **$ARGUMENTS**, transforming stored state from the previous version to the current spec version.


> **When to use:** Use when concept schemas have changed and stored state needs to be migrated to match the new version. Covers migration planning, dry-run validation, and execution.


## Design Principles

- **Version Gating:** A concept cannot start until its storage schema matches its current spec version — the migration concept gates startup.
- **Reversible by Default:** Every migration step should have a corresponding rollback step — data transformations should be invertible.

## Step-by-Step Process

### Step 1: Plan Migration

Analyze schema changes and plan migration steps for concept state transitions.

**Checklist:**
- [ ] Schema diff shows expected changes?
- [ ] No data loss in state transformations?
- [ ] Rollback strategy identified?

**Examples:**
*Plan a migration*
```bash
copf migrate --plan
```

### Step 2: Apply Migration

Execute the planned migration, transforming stored state to match the new schema.

**Checklist:**
- [ ] Backup created before applying?
- [ ] Migration ran to completion?
- [ ] Post-migration validation passed?

**Examples:**
*Apply migration*
```bash
copf migrate --apply
```

## References

- [Migration planning and execution guide](references/migration-guide.md)
## Supporting Materials

- [Migration execution walkthrough](examples/run-a-migration.md)
## Quick Reference

| Action | Command | Purpose |
|--------|---------|---------|
| plan | `copf migrate --plan` | Show planned migration steps |
| apply | `copf migrate --apply` | Execute migration |
| status | `copf migrate --status` | Check current schema versions |


## Validation

*Check migration status:*
```bash
npx tsx tools/copf-cli/src/index.ts migrate --status
```
*Run migration dry-run:*
```bash
npx tsx tools/copf-cli/src/index.ts migrate --dry-run
```
## Related Skills

| Skill | When to Use |
| --- | --- |
| `/concept-validator` | Validate the updated concept spec |
| `/implementation-builder` | Update the handler implementation after schema change |
| `/deployment-config` | Re-validate deployment after migration |
