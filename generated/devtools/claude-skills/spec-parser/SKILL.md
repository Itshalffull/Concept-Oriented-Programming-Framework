---
name: spec-parser
description: Parse concept files into structured ASTs
argument-hint: $ARGUMENTS
allowed-tools: Read, Grep, Glob, Edit, Write, Bash
---

<!-- Auto-generated by COPF Interface Kit — claude-skills target -->
<!-- Concept: SpecParser -->
<!-- Do not edit manually; regenerate with: clef interface generate -->

# SpecParser

Parse and validate concept spec **$ARGUMENTS** to verify syntax, structure, and adherence to Jackson's concept design methodology.


> **When to use:** Use when designing, creating, or validating concept specs following Jackson's methodology. Covers purpose articulation, state design, action design, invariant writing, and spec syntax validation.


## Design Principles

- **Spec as Source of Truth:** The .concept file is the single authoritative definition — all generated code, tests, and documentation derive from it.
- **Fail Fast on Ambiguity:** Parser rejects specs with ambiguous state relations or incomplete action signatures rather than guessing intent.

## Step-by-Step Process

### Step 1: Parse and Validate

Parse all .concept specs in the project and report syntax or structural errors.

**Arguments:** `$0` **source** (string)

**Checklist:**
- [ ] Has purpose block?
- [ ] Actions have at least one variant?
- [ ] Invariants reference valid actions?
- [ ] Type parameters declared and used?
- [ ] Variant descriptions explain outcomes, not just echo variant names?

**Examples:**
*Parse a concept file*
```typescript
import { parseConceptFile } from './parser';
const ast = parseConceptFile(source);
```
*Parse from CLI*
```bash
clef check specs/my-concept.concept
```

## References

- [Concept grammar reference](references/concept-grammar.md)
- [Jackson's concept design methodology](references/jackson-methodology.md)
## Supporting Materials

- [End-to-end concept design walkthrough](examples/design-a-concept.md)
## Quick Reference

| Action | Command | Purpose |
|--------|---------|---------|
| parse | `clef check <file>` | Validate concept spec syntax and structure |


## Example Walkthroughs

For complete examples with design rationale:

- [Design a concept from scratch (Bookmark example)](examples/design-a-concept.md)
## Anti-Patterns

### Missing purpose block
Concept spec has no purpose — impossible to evaluate design quality.

**Bad:**
```
concept User [U] {
  state { users: set U; name: U -> String }
  actions { action create(name: String) { -> ok(user: U) { Created. } } }
}

```

**Good:**
```
concept User [U] {
  purpose { Manage user identity and profile information. }
  state { users: set U; name: U -> String }
  actions { action create(name: String) { -> ok(user: U) { New user registered. } } }
}

```

### Terse or echo variant descriptions
Variant descriptions that echo the variant name or use a single generic word — they tell the reader nothing about the actual outcome.

**Bad:**
```
action create(name: String) {
  -> ok(user: U) { Created. }
  -> duplicate(name: String) { Name taken. }
  -> error(message: String) { Failed. }
}

```

**Good:**
```
action create(name: String) {
  -> ok(user: U) { New user registered and ready for authentication setup. }
  -> duplicate(name: String) { A user with this name already exists. }
  -> error(message: String) { Creation failed due to a storage or validation error. }
}

```

### Untyped action parameters
Action parameters lack types — generated code will use 'any'.

**Bad:**
```
action create(name, email) { -> ok(user: U) { Created. } }

```

**Good:**
```
action create(name: String, email: String) { -> ok(user: U) { New user registered. } }

```
## Validation

*Parse and validate all concept specs:*
```bash
npx tsx cli/src/index.ts check
```
*Run parser tests:*
```bash
npx vitest run tests/spec-parser.test.ts
```
## Related Skills

| Skill | When to Use |
| --- | --- |
| `/concept-designer` | Design new concepts following Jackson's methodology |
| `/implementation-builder` | Write handlers that implement concept actions |
| `/sync-designer` | Write syncs that connect concepts together |
