// PessimisticLock â€” types.ts
// Generated by NextjsGen. Do not edit manually.
// Uses fp-ts for purely functional, composable concept implementations.

import * as O from 'fp-ts/Option';

// Storage interface for PessimisticLock
export interface PessimisticLockStorage {
  readonly get: (relation: string, key: string) => Promise<Record<string, unknown> | null>;
  readonly put: (relation: string, key: string, value: Record<string, unknown>) => Promise<void>;
  readonly delete: (relation: string, key: string) => Promise<boolean>;
  readonly find: (relation: string, filter?: Record<string, unknown>) => Promise<readonly Record<string, unknown>[]>;
}

export interface PessimisticLockCheckOutInput {
  readonly resource: string;
  readonly holder: string;
  readonly duration: O.Option<number>;
  readonly reason: O.Option<string>;
}

export interface PessimisticLockCheckOutOutputOk {
  readonly variant: 'ok';
  readonly lockId: string;
}

export interface PessimisticLockCheckOutOutputAlreadyLocked {
  readonly variant: 'alreadyLocked';
  readonly holder: string;
  readonly expires: O.Option<string>;
}

export interface PessimisticLockCheckOutOutputQueued {
  readonly variant: 'queued';
  readonly position: number;
}

export type PessimisticLockCheckOutOutput = PessimisticLockCheckOutOutputOk | PessimisticLockCheckOutOutputAlreadyLocked | PessimisticLockCheckOutOutputQueued;

export interface PessimisticLockCheckInInput {
  readonly lockId: string;
}

export interface PessimisticLockCheckInOutputOk {
  readonly variant: 'ok';
}

export interface PessimisticLockCheckInOutputNotFound {
  readonly variant: 'notFound';
  readonly message: string;
}

export interface PessimisticLockCheckInOutputNotHolder {
  readonly variant: 'notHolder';
  readonly message: string;
}

export type PessimisticLockCheckInOutput = PessimisticLockCheckInOutputOk | PessimisticLockCheckInOutputNotFound | PessimisticLockCheckInOutputNotHolder;

export interface PessimisticLockBreakLockInput {
  readonly lockId: string;
  readonly breaker: string;
  readonly reason: string;
}

export interface PessimisticLockBreakLockOutputOk {
  readonly variant: 'ok';
  readonly previousHolder: string;
}

export interface PessimisticLockBreakLockOutputNotFound {
  readonly variant: 'notFound';
  readonly message: string;
}

export interface PessimisticLockBreakLockOutputUnauthorized {
  readonly variant: 'unauthorized';
  readonly message: string;
}

export type PessimisticLockBreakLockOutput = PessimisticLockBreakLockOutputOk | PessimisticLockBreakLockOutputNotFound | PessimisticLockBreakLockOutputUnauthorized;

export interface PessimisticLockRenewInput {
  readonly lockId: string;
  readonly additionalDuration: number;
}

export interface PessimisticLockRenewOutputOk {
  readonly variant: 'ok';
  readonly newExpires: string;
}

export interface PessimisticLockRenewOutputNotFound {
  readonly variant: 'notFound';
  readonly message: string;
}

export interface PessimisticLockRenewOutputNotHolder {
  readonly variant: 'notHolder';
  readonly message: string;
}

export type PessimisticLockRenewOutput = PessimisticLockRenewOutputOk | PessimisticLockRenewOutputNotFound | PessimisticLockRenewOutputNotHolder;

export interface PessimisticLockQueryLocksInput {
  readonly resource: O.Option<string>;
}

export interface PessimisticLockQueryLocksOutput {
  readonly variant: 'ok';
  readonly locks: readonly string[];
}

export interface PessimisticLockQueryQueueInput {
  readonly resource: string;
}

export interface PessimisticLockQueryQueueOutput {
  readonly variant: 'ok';
  readonly waiters: readonly { readonly requester: string; readonly requested: string }[];
}

// --- Variant constructors ---

export const checkOutOk = (lockId: string): PessimisticLockCheckOutOutput => ({ variant: 'ok', lockId } as PessimisticLockCheckOutOutput);
export const checkOutAlreadyLocked = (holder: string, expires: O.Option<string>): PessimisticLockCheckOutOutput => ({ variant: 'alreadyLocked', holder, expires } as PessimisticLockCheckOutOutput);
export const checkOutQueued = (position: number): PessimisticLockCheckOutOutput => ({ variant: 'queued', position } as PessimisticLockCheckOutOutput);

export const checkInOk = (): PessimisticLockCheckInOutput => ({ variant: 'ok' } as PessimisticLockCheckInOutput);
export const checkInNotFound = (message: string): PessimisticLockCheckInOutput => ({ variant: 'notFound', message } as PessimisticLockCheckInOutput);
export const checkInNotHolder = (message: string): PessimisticLockCheckInOutput => ({ variant: 'notHolder', message } as PessimisticLockCheckInOutput);

export const breakLockOk = (previousHolder: string): PessimisticLockBreakLockOutput => ({ variant: 'ok', previousHolder } as PessimisticLockBreakLockOutput);
export const breakLockNotFound = (message: string): PessimisticLockBreakLockOutput => ({ variant: 'notFound', message } as PessimisticLockBreakLockOutput);
export const breakLockUnauthorized = (message: string): PessimisticLockBreakLockOutput => ({ variant: 'unauthorized', message } as PessimisticLockBreakLockOutput);

export const renewOk = (newExpires: string): PessimisticLockRenewOutput => ({ variant: 'ok', newExpires } as PessimisticLockRenewOutput);
export const renewNotFound = (message: string): PessimisticLockRenewOutput => ({ variant: 'notFound', message } as PessimisticLockRenewOutput);
export const renewNotHolder = (message: string): PessimisticLockRenewOutput => ({ variant: 'notHolder', message } as PessimisticLockRenewOutput);

export const queryLocksOk = (locks: readonly string[]): PessimisticLockQueryLocksOutput => ({ variant: 'ok', locks } as PessimisticLockQueryLocksOutput);

export const queryQueueOk = (waiters: readonly { readonly requester: string; readonly requested: string }[]): PessimisticLockQueryQueueOutput => ({ variant: 'ok', waiters } as PessimisticLockQueryQueueOutput);

