// Migration â€” types.ts
// Generated by NextjsGen. Do not edit manually.
// Uses fp-ts for purely functional, composable concept implementations.

// Storage interface for Migration
export interface MigrationStorage {
  readonly get: (relation: string, key: string) => Promise<Record<string, unknown> | null>;
  readonly put: (relation: string, key: string, value: Record<string, unknown>) => Promise<void>;
  readonly delete: (relation: string, key: string) => Promise<boolean>;
  readonly find: (relation: string, filter?: Record<string, unknown>) => Promise<readonly Record<string, unknown>[]>;
}

export interface MigrationPlanInput {
  readonly concept: string;
  readonly fromVersion: number;
  readonly toVersion: number;
}

export interface MigrationPlanOutputOk {
  readonly variant: 'ok';
  readonly migration: string;
  readonly steps: readonly string[];
  readonly estimatedRecords: number;
}

export interface MigrationPlanOutputNoMigrationNeeded {
  readonly variant: 'noMigrationNeeded';
  readonly concept: string;
}

export interface MigrationPlanOutputIncompatible {
  readonly variant: 'incompatible';
  readonly concept: string;
  readonly reason: string;
}

export type MigrationPlanOutput = MigrationPlanOutputOk | MigrationPlanOutputNoMigrationNeeded | MigrationPlanOutputIncompatible;

export interface MigrationExpandInput {
  readonly migration: string;
}

export interface MigrationExpandOutputOk {
  readonly variant: 'ok';
  readonly migration: string;
}

export interface MigrationExpandOutputFailed {
  readonly variant: 'failed';
  readonly migration: string;
  readonly reason: string;
}

export type MigrationExpandOutput = MigrationExpandOutputOk | MigrationExpandOutputFailed;

export interface MigrationMigrateInput {
  readonly migration: string;
}

export interface MigrationMigrateOutputOk {
  readonly variant: 'ok';
  readonly migration: string;
  readonly recordsMigrated: number;
}

export interface MigrationMigrateOutputPartial {
  readonly variant: 'partial';
  readonly migration: string;
  readonly migrated: number;
  readonly failed: number;
  readonly errors: readonly string[];
}

export type MigrationMigrateOutput = MigrationMigrateOutputOk | MigrationMigrateOutputPartial;

export interface MigrationContractInput {
  readonly migration: string;
}

export interface MigrationContractOutputOk {
  readonly variant: 'ok';
  readonly migration: string;
}

export interface MigrationContractOutputRollback {
  readonly variant: 'rollback';
  readonly migration: string;
}

export type MigrationContractOutput = MigrationContractOutputOk | MigrationContractOutputRollback;

export interface MigrationStatusInput {
  readonly migration: string;
}

export interface MigrationStatusOutput {
  readonly variant: 'ok';
  readonly migration: string;
  readonly phase: string;
  readonly progress: number;
}

// --- Variant constructors ---

export const planOk = (migration: string, steps: readonly string[], estimatedRecords: number): MigrationPlanOutput => ({ variant: 'ok', migration, steps, estimatedRecords } as MigrationPlanOutput);
export const planNoMigrationNeeded = (concept: string): MigrationPlanOutput => ({ variant: 'noMigrationNeeded', concept } as MigrationPlanOutput);
export const planIncompatible = (concept: string, reason: string): MigrationPlanOutput => ({ variant: 'incompatible', concept, reason } as MigrationPlanOutput);

export const expandOk = (migration: string): MigrationExpandOutput => ({ variant: 'ok', migration } as MigrationExpandOutput);
export const expandFailed = (migration: string, reason: string): MigrationExpandOutput => ({ variant: 'failed', migration, reason } as MigrationExpandOutput);

export const migrateOk = (migration: string, recordsMigrated: number): MigrationMigrateOutput => ({ variant: 'ok', migration, recordsMigrated } as MigrationMigrateOutput);
export const migratePartial = (migration: string, migrated: number, failed: number, errors: readonly string[]): MigrationMigrateOutput => ({ variant: 'partial', migration, migrated, failed, errors } as MigrationMigrateOutput);

export const contractOk = (migration: string): MigrationContractOutput => ({ variant: 'ok', migration } as MigrationContractOutput);
export const contractRollback = (migration: string): MigrationContractOutput => ({ variant: 'rollback', migration } as MigrationContractOutput);

export const statusOk = (migration: string, phase: string, progress: number): MigrationStatusOutput => ({ variant: 'ok', migration, phase, progress } as MigrationStatusOutput);

