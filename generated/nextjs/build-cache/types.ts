// BuildCache â€” types.ts
// Generated by NextjsGen. Do not edit manually.
// Uses fp-ts for purely functional, composable concept implementations.

import * as O from 'fp-ts/Option';

// Storage interface for BuildCache
export interface BuildCacheStorage {
  readonly get: (relation: string, key: string) => Promise<Record<string, unknown> | null>;
  readonly put: (relation: string, key: string, value: Record<string, unknown>) => Promise<void>;
  readonly delete: (relation: string, key: string) => Promise<boolean>;
  readonly find: (relation: string, filter?: Record<string, unknown>) => Promise<readonly Record<string, unknown>[]>;
}

export interface BuildCacheCheckInput {
  readonly stepKey: string;
  readonly inputHash: string;
  readonly deterministic: boolean;
}

export interface BuildCacheCheckOutputUnchanged {
  readonly variant: 'unchanged';
  readonly lastRun: Date;
  readonly outputRef: O.Option<string>;
}

export interface BuildCacheCheckOutputChanged {
  readonly variant: 'changed';
  readonly previousHash: O.Option<string>;
}

export type BuildCacheCheckOutput = BuildCacheCheckOutputUnchanged | BuildCacheCheckOutputChanged;

export interface BuildCacheRecordInput {
  readonly stepKey: string;
  readonly inputHash: string;
  readonly outputHash: string;
  readonly outputRef: O.Option<string>;
  readonly sourceLocator: O.Option<string>;
  readonly deterministic: boolean;
}

export interface BuildCacheRecordOutput {
  readonly variant: 'ok';
  readonly entry: string;
}

export interface BuildCacheInvalidateInput {
  readonly stepKey: string;
}

export interface BuildCacheInvalidateOutputOk {
  readonly variant: 'ok';
}

export interface BuildCacheInvalidateOutputNotFound {
  readonly variant: 'notFound';
}

export type BuildCacheInvalidateOutput = BuildCacheInvalidateOutputOk | BuildCacheInvalidateOutputNotFound;

export interface BuildCacheInvalidateBySourceInput {
  readonly sourceLocator: string;
}

export interface BuildCacheInvalidateBySourceOutput {
  readonly variant: 'ok';
  readonly invalidated: readonly string[];
}

export interface BuildCacheInvalidateByKindInput {
  readonly kindName: string;
}

export interface BuildCacheInvalidateByKindOutput {
  readonly variant: 'ok';
  readonly invalidated: readonly string[];
}

export interface BuildCacheInvalidateAllInput {
}

export interface BuildCacheInvalidateAllOutput {
  readonly variant: 'ok';
  readonly cleared: number;
}

export interface BuildCacheStatusInput {
}

export interface BuildCacheStatusOutput {
  readonly variant: 'ok';
  readonly entries: readonly { readonly stepKey: string; readonly inputHash: string; readonly lastRun: Date; readonly stale: boolean }[];
}

export interface BuildCacheStaleStepsInput {
}

export interface BuildCacheStaleStepsOutput {
  readonly variant: 'ok';
  readonly steps: readonly string[];
}

// --- Variant constructors ---

export const checkUnchanged = (lastRun: Date, outputRef: O.Option<string>): BuildCacheCheckOutput => ({ variant: 'unchanged', lastRun, outputRef } as BuildCacheCheckOutput);
export const checkChanged = (previousHash: O.Option<string>): BuildCacheCheckOutput => ({ variant: 'changed', previousHash } as BuildCacheCheckOutput);

export const recordOk = (entry: string): BuildCacheRecordOutput => ({ variant: 'ok', entry } as BuildCacheRecordOutput);

export const invalidateOk = (): BuildCacheInvalidateOutput => ({ variant: 'ok' } as BuildCacheInvalidateOutput);
export const invalidateNotFound = (): BuildCacheInvalidateOutput => ({ variant: 'notFound' } as BuildCacheInvalidateOutput);

export const invalidateBySourceOk = (invalidated: readonly string[]): BuildCacheInvalidateBySourceOutput => ({ variant: 'ok', invalidated } as BuildCacheInvalidateBySourceOutput);

export const invalidateByKindOk = (invalidated: readonly string[]): BuildCacheInvalidateByKindOutput => ({ variant: 'ok', invalidated } as BuildCacheInvalidateByKindOutput);

export const invalidateAllOk = (cleared: number): BuildCacheInvalidateAllOutput => ({ variant: 'ok', cleared } as BuildCacheInvalidateAllOutput);

export const statusOk = (entries: readonly { readonly stepKey: string; readonly inputHash: string; readonly lastRun: Date; readonly stale: boolean }[]): BuildCacheStatusOutput => ({ variant: 'ok', entries } as BuildCacheStatusOutput);

export const staleStepsOk = (steps: readonly string[]): BuildCacheStaleStepsOutput => ({ variant: 'ok', steps } as BuildCacheStaleStepsOutput);

