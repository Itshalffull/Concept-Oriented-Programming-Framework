# Conduit â€” Local Development Deployment Manifest
#
# Single-process local runtime with in-memory storage,
# in-process transport, and dotenv-based secrets.
# Ideal for rapid development and debugging.
#
# Usage:
#   clef deploy --manifest deploy/local.deploy.yaml

app:
  name: conduit
  version: "0.1.0"
  uri: urn:conduit

runtimes:
  local:
    type: LocalRuntime
    engine: true
    transport: in-process
    storage: memory
    secrets: dotenv
    config:
      port: "${PORT:-3000}"
      dotenvPath: ".env"
      hotReload: true

concepts:
  User:
    spec: specs/app/user.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/user.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  Password:
    spec: specs/app/password.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/password.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  JWT:
    spec: specs/app/jwt.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/jwt.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  Profile:
    spec: specs/app/profile.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/profile.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  Article:
    spec: specs/app/article.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/article.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  Comment:
    spec: kits/content/comment.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/comment.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  Tag:
    spec: kits/classification/tag.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/tag.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  Favorite:
    spec: specs/app/favorite.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/favorite.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  Follow:
    spec: specs/app/follow.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/follow.impl.ts
        runtime: local
        storage: memory
        queryMode: lite
  Echo:
    spec: specs/app/echo.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/echo.impl.ts
        runtime: local
        storage: memory
        queryMode: lite

syncs:
  - path: syncs/app/registration.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/login.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/articles.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/comments.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/social.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/profile.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/echo.sync
    engine: engine
    annotations: [eager]

build:
  typescript:
    compiler: tsc
    testRunner: vitest
    testTypes:
      - unit
      - integration
