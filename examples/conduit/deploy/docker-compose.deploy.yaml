# Conduit â€” Docker Compose Deployment Manifest
#
# Containerized deployment with Redis-backed storage,
# in-process transport, and environment-variable secrets.
# Suitable for staging environments and local production testing.
#
# Usage:
#   clef deploy --manifest deploy/docker-compose.deploy.yaml

app:
  name: conduit
  version: "0.1.0"
  uri: urn:conduit

runtimes:
  docker:
    type: DockerComposeRuntime
    engine: true
    transport: in-process
    storage: redis
    secrets: env
    config:
      image: conduit-clef:latest
      port: "${PORT:-3000}"
      replicas: 1
      healthCheck:
        path: /health
        interval: 30s

infrastructure:
  storage:
    redis:
      type: redis
      config:
        host: "${REDIS_HOST:-redis}"
        port: "${REDIS_PORT:-6379}"
        keyPrefix: "conduit:"

concepts:
  User:
    spec: specs/app/user.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/user.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  Password:
    spec: specs/app/password.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/password.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  JWT:
    spec: specs/app/jwt.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/jwt.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  Profile:
    spec: specs/app/profile.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/profile.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  Article:
    spec: specs/app/article.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/article.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  Comment:
    spec: kits/content/comment.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/comment.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  Tag:
    spec: kits/classification/tag.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/tag.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  Favorite:
    spec: specs/app/favorite.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/favorite.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  Follow:
    spec: specs/app/follow.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/follow.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite
  Echo:
    spec: specs/app/echo.concept
    implementations:
      - language: typescript
        path: handlers/ts/app/echo.impl.ts
        runtime: docker
        storage: redis
        queryMode: lite

syncs:
  - path: syncs/app/registration.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/login.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/articles.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/comments.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/social.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/profile.sync
    engine: engine
    annotations: [eager]
  - path: syncs/app/echo.sync
    engine: engine
    annotations: [eager]
